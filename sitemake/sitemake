#!/bin/bash


to_html() {
        pandoc -s "$1" -o "${1%.*}.html"
}


to_markdown() {
        pandoc -s "${1%.*}.html" -o "readme.md"
}


do_conversions() {
        to_html "$1" && to_markdown "${1%.*}.html"
}


add_custom_css() {
        sed -i 's/<\/style>/<\/style>\n<link rel="stylesheet" href="index.css">/' "$1"
}


augment_html() {
        add_custom_css "$1"
}


for note in *
do
        if [[ -d "$note" ]]; then
                if [[ -f "$note/$note.tex" ]]; then
                        ( cd "$note" && \
                          do_conversions "$note.tex" && \
                          augment_html "${note%.*}.html" && \
                          mv "${note%.*}.html" "../docs" )
                fi
        fi
done
